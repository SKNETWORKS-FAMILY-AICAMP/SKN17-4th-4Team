{% load static %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ë² ì´ë¹„ê°€ì´ë“œ</title>

    <!-- ì •ë¦¬ëœ ë§í¬ë“¤ -->
    <link rel="icon" type="image/png" href="{% static 'img/logo.png' %}" />
    <link rel="stylesheet" href="{% static 'css/global.css' %}" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
  </head>
  <body>
    {% include 'partials/header.html' %}

  <!-- ë©”ì¸ -->
  <main class="login">
    <div class="container login__grid">
      <!-- ì™¼ìª½ ì¹´ë“œ -->
      <section class="login__card">
        <h1 class="login__title">ë¡œê·¸ì¸</h1>
        <form method="post" action="{% url 'login' %}">
            {% csrf_token %}
                  <label for="email" class="login__label">ì•„ì´ë”” ë˜ëŠ” ì´ë©”ì¼</label>
                  <input id="email" type="text" name="username" class="login__input" placeholder="ì•„ì´ë”” ë˜ëŠ” ì´ë©”ì¼" required />

                  <label for="password" class="login__label">ë¹„ë°€ë²ˆí˜¸</label>
                  <div class="login__pw">
                    <input id="password" type="password" name="password" class="login__input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required />
                    <button type="button" class="login__pw-toggle" aria-label="ë¹„ë°€ë²ˆí˜¸ ë³´ê¸°">ğŸ‘ï¸</button>
                  </div>

                  <button type="submit" class="btn btn--cta login__submit">ë¡œê·¸ì¸</button>
                  {% if error %}
            <p style="color:red; margin-top:12px;">{{ error }}</p>
          {% endif %}
          <div class="login__links">
            <a href="{% url 'signup' %}" class="login__link">íšŒì›ê°€ì…</a>
            <a href="{% url 'password_reset' %}" class="login__link">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
          </div>
        </form>
      </section>

      <!-- ì˜¤ë¥¸ìª½ ì´ë¯¸ì§€ -->
      <figure class="login__figure">
        <img src="{% static 'img/login_blue.jpg' %}" alt="ì•„ê¸° ìŠ¬ë¦¬í¼ ì´ë¯¸ì§€" class="login__image" />
      </figure>
    </div>
  </main>

  {% include 'partials/footer.html' %}

  <!-- ëª¨ë‹¬ -->
  <div id="appModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal__backdrop" data-close-modal></div>
    <div class="modal__panel">
      <h3 id="modalTitle" class="modal__title">ì•Œë¦¼</h3>
      <div id="modalMessage" class="modal__body">ë©”ì‹œì§€</div>
      <div class="modal__actions">
        <button type="button" class="modal__btn" data-close-modal>í™•ì¸</button>
      </div>
    </div>
  </div>
    
    <script>
      // ë¹„ë°€ë²ˆí˜¸ ë³´ê¸° í† ê¸€
      const pw = document.getElementById('password');
      const toggle = document.querySelector('.login__pw-toggle');
      toggle.addEventListener('click', () => {
        pw.type = pw.type === 'password' ? 'text' : 'password';
      });

      // ëª¨ë‹¬ ê´€ë ¨
      {% if show_modal %}
      document.addEventListener('DOMContentLoaded', () => {
        const modal = document.querySelector('#appModal');
        const modalMsg = document.querySelector('#modalMessage');
        const modalTitle = document.querySelector('#modalTitle');

        function openModal(message, title='ì•Œë¦¼') {
          modalTitle.textContent = title;
          modalMsg.textContent = message;
          modal.classList.add('modal--open');
          document.documentElement.style.overflow = 'hidden';
        }
        function closeModal() {
          modal.classList.remove('modal--open');
          document.documentElement.style.overflow = '';
        }
        modal.addEventListener('click', (e) => {
          if (e.target.matches('[data-close-modal]')) closeModal();
        });
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') closeModal();
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ íŒì—… ë„ìš°ê¸°
        openModal('{{ error }}');
      });
      {% endif %}
    </script>
  </body>
</html>
